# åˆ›å»ºDockersæœåŠ¡å™¨ç¾¤(LetsEncryptåå‘ä»£ç†ç¯‡)

> å…ˆæ¥è¯´è¯´Letsencryptæ˜¯ä»€ä¹ˆå§ï¼Œè¿™å°±è¦ä»å¤§å®¶å°å­¦äºŒå¹´çº§å°±å­¦è¿‡çš„httpé€šä¿¡è¯´èµ·äº†ï¼Œä¼—æ‰€å‘¨çŸ¥HTTPåè®®æ˜¯ **æ˜æ–‡** é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ…æ‹¬ä½ åœ¨ç½‘é¡µä¸Šè¾“å…¥çš„å¯†ç ï¼Œåœ¨ä¼ é€’åˆ°æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è£¸å¥”çš„ï¼Œä¸€æ—¦æœ‰äººæˆªè·äº†ä½ è¾“å…¥å¯†ç çš„è¿™ä¸ªæ•°æ®åŒ…çš„è¯ï¼Œä½ çš„å¯†ç å‡ ä¹å°±è¢«ç¬é—´ç ´è§£äº†ï¼ˆè™½ç„¶ç”¨äº†ç‚¹æ‰‹æ®µï¼Œä½†æ˜¯å¾ˆå®¹æ˜“è¢«ç ´è§£ï¼Œè‚¯å®šæ²¡æœ‰sslæˆ–è€…tlsä½¿ç”¨çš„RSA *éå¯¹ç§°åŠ å¯†* æ¥çš„å®‰å…¨ï¼‰ï¼Œæ‰€ä»¥å‘¢ï¼Œè¿˜æ˜¯æ¨èå¤§å®¶ä½¿ç”¨httpsé€šä¿¡çš„ã€‚letsencryptæœåŠ¡èƒ½ä¸ºä½ çš„ç½‘ç«™æä¾›å…è´¹httpsåŠ å¯†çš„åŒæ—¶ï¼Œè¿˜æ”¯æŒå¤šåŸŸåçš„åå‘ä»£ç†ï¼Œéå¸¸æ–¹ä¾¿ã€‚

## å¼€å§‹å‰çš„åºŸè¯

å…ˆä»‹ç»ä»‹ç»ç›¸å…³æŠ€æœ¯å§

* HTTPSåŠ å¯†æŠ€æœ¯æ˜¯ä¸ªå•¥
* ä»€ä¹ˆæ˜¯åå‘ä»£ç†

### HTTPSåŠ å¯†

å¦‚æœä½ å’Œç¬”è€…ä¸€æ ·ä½¿ç”¨çš„æ˜¯chromeæµè§ˆå™¨çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¾“å…¥ç½‘å€çš„æ–‡æœ¬æ¡†æ—è¾¹æœ‰ä¸€ä¸ªğŸ”’çš„å›¾æ ‡ï¼Œè¿™è¡¨ç¤ºç€æ­¤ç½‘ç«™ä½¿ç”¨äº† **è¢«æ‰¿è®¤çš„åŠ å¯†è¯ä¹¦** ï¼Œå¹¶ä¸”å±•å¼€URLæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢è¡¨ç¤ºåè®®çš„éƒ¨åˆ†æœ‰httpsçš„å­—æ ·

![image-20210222003146133](LetsEncrypt.assets/image-20210222003146133.png)

ç›¸åï¼Œæ²¡æœ‰ä½¿ç”¨åŠ å¯†æŠ€æœ¯çš„ç½‘ç«™å°±ä¼šä½¿è¿™æ ·ï¼Œæµè§ˆå™¨å°±ä¼šå‡ºç°æœªåŠ å¯†çš„è­¦å‘Šæç¤º

![image-20210222003205493](LetsEncrypt.assets/image-20210222003205493.png)

å…¶å®è¿˜ä¼šæœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ç½‘å€ä½¿ç”¨äº†åŠ å¯†ï¼Œä½†æ˜¯åŠ å¯†è¯ä¹¦ **ä¸è¢«æ‰¿è®¤**  æ‰€ä»¥æµè§ˆå™¨ä¼šæç¤ºé£é™©é¡µé¢ï¼ˆæ¯”å¦‚è‡ªå·±ç”¨opensslç”Ÿæˆçš„å¥‡å¥‡æ€ªæ€ªçš„è¯ä¹¦ï¼Œæˆ–è€…å·²ç»åˆ°æœŸçš„caè¯ä¹¦ï¼Œéƒ½ä¼šè®©æµè§ˆå™¨äº§ç”Ÿè¿™æ ·çš„æç¤ºï¼‰ï¼Œè¿™è®©æ‹¥æœ‰å¼ºè¿«ç—‡çš„æˆ‘éå¸¸çš„ä¸çˆ½

![image-20210222003534116](LetsEncrypt.assets/image-20210222003534116.png)

è¦æŸ¥çœ‹ç½‘ç»œå¯¹åº”çš„è¯ä¹¦åœ¨å°ğŸ”’ä¸Šç‚¹å‡»æŸ¥çœ‹è¯ä¹¦å³å¯

![image-20210222003947305](LetsEncrypt.assets/image-20210222003947305.png)

å·²ç»è®¤è¯çš„è¯ä¹¦æˆ‘å°±ä¸å±•ç¤ºäº†ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªå¸¦ç½‘ç«™éƒ½å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥åœ¨whoisä¸ŠæŸ¥åˆ°å°±ä¸å¤šèµ˜è¿°äº†ï¼Œè¿™é‡Œåªå±•ç¤ºä¸€ä¸‹ä¸å—ä¿¡ä»»çš„è¯ä¹¦æ˜¯ä»€ä¹ˆæ ·å­

![image-20210222005630285](LetsEncrypt.assets/image-20210222005630285.png)

è¿™ä¸ªæ˜¯å†…ç½‘é˜²ç«å¢™ä½¿ç”¨opensslç»™è‡ªå·±é¢å‘çš„è¯ä¹¦ï¼Œå½“ç„¶æ˜¯ä¸å—ä¿¡ä»»çš„ï¼Œæ˜¯ä¸æ˜¯å¾ˆç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆåŠ å¯†è¿˜æœ‰ä¿¡ä»»å’Œä¸ä¿¡ä»»çš„ï¼Œè¯ä¹¦åˆæ˜¯ä»€ä¹ˆå•Šï¼Œå’ŒåŠ å¯†æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸‹é¢æˆ‘å°±ç®€å•å¾—æŠ›å‡ ä¸ªâ€œä¸“ä¸šæœ¯è¯­â€ï¼Œç„¶åç”¨è‡ªå·±çš„è¯­è¨€æ¦‚æ‹¬æ€»ç»“ä¸€ä¸‹ï¼Œæœ‰å…´è¶£çš„åŒå¿—å¯ä»¥å»äº†è§£ä¸€ä¸‹

* RSAéå¯¹ç§°åŠ å¯†
* CAè¯ä¹¦
* TLSå’ŒSSL

è¯´ç™½äº†ï¼Œå¦‚æœä½ è¦å¼€ä¸€ä¸ªå¹²æ‚åº—ï¼Œå°±éœ€è¦æœ‰ä¸€å¼ è¥ä¸šæ‰§ç…§ï¼ŒåŒç†ç½‘ç«™è¦åˆæ³•åˆè§„ï¼Œè¦æœ‰æœ‰ä¿¡ç”¨çš„äººæˆ–è€…æœºæ„æ¥ç»™ä½ ä½œè¯ï¼Œè¦é¢å‘ä¸€ä¸ªè¯ä¹¦ç»™ä½ ï¼ˆå›½å®¶ç»™ä½ è¥ä¸šæ‰§ç…§ï¼ŒCAæœºæ„ç»™ä½ é¢å‘CAè¯ä¹¦ï¼‰ï¼Œè™½ç„¶ä¸ºäº†æ°é¥­ï¼ˆé€šä¿¡åŠ å¯†ï¼‰ä½ å¯ä»¥ç”¨ä¸€å¼ è‡ªå·±ç”»çš„ï¼ˆè‡ªå·±ç”Ÿæˆï¼‰çš„è¥ä¸šæ‰§ç…§ï¼ˆCAè¯ä¹¦ï¼‰ï¼Œä½†æ˜¯ä½ çš„å¹²æ‚åº—ï¼ˆç½‘ç«™ï¼‰è‚¯å®šä¸æ˜¯æ­£è§„çš„ã€‚

ä»ä¸Šé¢çš„è¿™ä¸ªéå¸¸ä¸æ°å½“çš„ä¾‹å­ä¸­ä¼°è®¡å¯ä»¥å¤§è‡´çš„ç†è§£è¯ä¹¦çš„æµç¨‹äº†ï¼Œä½†æ˜¯è¯ä¹¦å’ŒåŠ å¯†çš„å…³ç³»åœ¨è¿™å°±ä¸è®²äº†ï¼Œåæ­£çŸ¥é“CAä¸­å«æœ‰åŠ å¯†çš„é‡è¦éƒ¨ä»¶å°±è¡Œã€‚

æ—¢ç„¶æ˜¯æ‰¾ä¸€ä¸ªäººç»™ä½ ä½œè¯ï¼Œé‚£ä¹ˆmoneyè‚¯å®šæ˜¯å°‘ä¸äº†çš„ï¼ŒåŠè¯è¦é’±å•Šï¼Œå†è¯´äº†CAæœºæ„åœ¨æ€ä¹ˆæ‹‰è·¨ä¹Ÿç®—æ˜¯ä¸ªä¿å¯†ç›¸å…³çš„å•ä½äº†ï¼Œæ‰€ä»¥ä¹°ä¸€ä¸ªæ­£å¸¸çš„CAè¯ä¹¦å¤§è‡´çš„ä»·æ ¼æ˜¯ã€‚ã€‚ã€‚

![image-20210222011530389](LetsEncrypt.assets/image-20210222011530389.png)

éšä¾¿æ‰£å¼ å›¾ï¼Œå¥½å®¶ä¼™ï¼Œè¿™ä»·æ ¼æ€ä¹ˆä¸å»æŠ¢å•Š !

ä½†æ˜¯ï¼Œä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–ï¼Œè¥ä¸šæ‰§ç…§ä»·æ ¼æŠ¢äººï¼ŒğŸ‘´å°±è‡ªå·±åšä¸€ä¸ªï¼Œäºæ˜¯å°±è¯ç”Ÿäº†opensslè‡ªåˆ¶è¯ä¹¦çš„æ–¹æ³•ï¼Œä½†æ˜¯å‰é¢æåˆ°è¿‡è‡ªå·±ä½¿ç”¨çš„â€˜ä¸æ­£è§„â€™è¯ä¹¦ä¼šåœ¨æµè§ˆå™¨ä¸­å‡ºç°å®‰å…¨è­¦å‘Š

![image-20210222003534116](LetsEncrypt.assets/image-20210222003534116.png)

æå¾—æˆ‘20å¹´è€å¼ºè¿«ç—‡å¤å‘ï¼Œæ€ä¹ˆåŠæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œä¸€ä¸ªä¼Ÿå¤§çš„è€Œåˆç†Ÿæ‚‰çš„èº«å½±ç«™åœ¨äº†æˆ‘çš„å‰é¢ï¼Œä»–æ‹æ‹æˆ‘çš„è‚©è†€ï¼Œé€’ç»™æˆ‘ä¸€ä¸ªä¸œè¥¿ï¼Œç„¶åè½¬èº«åŒ†åŒ†ç¦»å»ï¼Œåœ¨ä»–é£æ‰¬çš„æŠ«é£ä¸Šï¼Œæˆ‘åªçœ‹åˆ°ä¸‰ä¸ªå¤§å­— **ç™½å«–å…š** ã€‚ç­‰æˆ‘å›è¿‡ç¥æ¥ï¼Œçœ‹äº†çœ‹æ‰‹ä¸Šä»–é€’ç»™æˆ‘çš„ä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯ä»Šå¤©çš„ä¸»è§’

**LetsEncrypt  :  ä¸€æ¬¾æä¾›å…è´¹åˆæ³•è¯ä¹¦çš„åå‘ä»£ç†è½¯ä»¶**

æŠ“é‡ç‚¹ **åˆæ³•CAã€åå‘ä»£ç†** æœ€é‡è¦çš„æ˜¯ **å…è´¹**

å¯èƒ½æœ‰äººä¼šé—®ï¼Œé‚£è¿™æ ·CAè¿˜æœ‰ä»€ä¹ˆæ„ä¹‰å—ï¼Œé»‘å®¢ä¸æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥è®©è‡ªå·±çš„é’“é±¼ç½‘ç«™çœ‹ä¸Šå»æ›´åƒé‚£ä¹ˆå›äº‹å—ï¼Œå¯¹äºè¿™ç§æ ç²¾ï¼Œæˆ‘ç‰¹ä¹ˆåªèƒ½è¯´ï¼Œè¯´é‚£ä¹ˆå¤šå¹²ä»€ä¹ˆï¼Œä¸Šä¸ä¸Šè½¦ï¼Œç™½å«–éƒ½ä¸é¦™å—ï¼Œå†ä¸ä¸Šè½¦æˆ‘å…³é—¨äº†ï¼

### åå‘ä»£ç†

åå‘ä»£ç†å¬ä¸Šå»å¾ˆé«˜ç«¯å¾ˆå¤§æ°”ï¼Œå®è´¨ä¸Šç¡®å®ä¹Ÿé«˜ç«¯å¤§æ°”ï¼Œåªä¸è¿‡è¿™é‡Œç”¨åˆ°çš„ä¸œè¥¿ç†è§£ä¸€ä¸‹åŸç†å°±å¥½ã€‚éšä¾¿å»çŸ¥ä¹å«–ä¸€ä¸ªè§£é‡Šçš„ç­”æ¡ˆéƒ½èƒ½æ¯”æˆ‘è‡ªå·±å†™çš„è´µè¯å¥½æ‡‚ã€‚

* ä»€ä¹ˆæ˜¯æ­£å‘ä»£ç†

  æˆ‘ä»¬å¸¸è¯´çš„ä»£ç†ä¹Ÿå°±æ˜¯åªæ­£å‘ä»£ç†ï¼Œæ­£å‘ä»£ç†çš„è¿‡ç¨‹ï¼Œå®ƒ **éšè—äº†çœŸå®çš„è¯·æ±‚å®¢æˆ·ç«¯** ï¼ŒæœåŠ¡ç«¯ä¸çŸ¥é“çœŸå®çš„å®¢æˆ·ç«¯æ˜¯è°ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„æœåŠ¡éƒ½è¢«ä»£ç†æœåŠ¡å™¨ä»£æ›¿æ¥è¯·æ±‚ï¼ŒæŸäº›ç§‘å­¦ä¸Šç½‘å·¥å…·æ‰®æ¼”çš„å°±æ˜¯å…¸å‹çš„æ­£å‘ä»£ç†è§’è‰²ã€‚ç”¨æµè§ˆå™¨è®¿é—® http://www.google.com æ—¶ï¼Œè¢«æ®‹å¿çš„blockï¼Œäºæ˜¯ä½ å¯ä»¥åœ¨å›½å¤–æ­å»ºä¸€å°ä»£ç†æœåŠ¡å™¨ï¼Œè®©ä»£ç†å¸®æˆ‘å»è¯·æ±‚google.comï¼Œä»£ç†æŠŠè¯·æ±‚è¿”å›çš„ç›¸åº”ç»“æ„å†è¿”å›ç»™æˆ‘ã€‚

  ![image-20210222235314499](LetsEncrypt.assets/image-20210222235314499.png)

* ä»€ä¹ˆæ˜¯åå‘ä»£ç†

  åå‘ä»£ç†éšè—äº†çœŸå®çš„æœåŠ¡ç«¯ï¼Œå½“æˆ‘ä»¬è¯·æ±‚ www.baidu.com çš„æ—¶å€™ï¼Œå°±åƒæ‹¨æ‰“10086ä¸€æ ·ï¼ŒèƒŒåå¯èƒ½æœ‰æˆåƒä¸Šä¸‡å°æœåŠ¡å™¨ä¸ºæˆ‘ä»¬æœåŠ¡ï¼Œä½†å…·ä½“æ˜¯å“ªä¸€å°ï¼Œä½ ä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ï¼Œä½ åªéœ€è¦çŸ¥é“åå‘ä»£ç†æœåŠ¡å™¨æ˜¯è°å°±å¥½äº†ï¼Œwww.baidu.com å°±æ˜¯æˆ‘ä»¬çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¼šå¸®æˆ‘ä»¬æŠŠè¯·æ±‚è½¬å‘åˆ°çœŸå®çš„æœåŠ¡å™¨é‚£é‡Œå»ã€‚Nginxå°±æ˜¯æ€§èƒ½éå¸¸å¥½çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”¨æ¥åšè´Ÿè½½å‡è¡¡ã€‚

  

  ![image-20210222235430543](LetsEncrypt.assets/image-20210222235430543.png)

* è¿™é‡Œçš„åå‘ä»£ç†æœ‰ä»€ä¹ˆç”¨

  æˆ‘ä»¬åœ¨å®¶é‡Œç”¨Letsencryptä½¿ç”¨çš„åå‘ä»£ç†ï¼Œä¸æ˜¯ä¸ºäº†è´Ÿè½½å‡è¡¡æˆ–è€…æ˜¯éšè—æœåŠ¡ç«¯ï¼Œåªæ˜¯ä¸ºäº†æˆ‘ä»¬çš„å­åŸŸåèƒ½è¢«æ­£å¸¸çš„ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»è´­ä¹°äº†ä¸€ä¸ªåŸŸå helloworld.comï¼Œå¹¶ä¸”æœ‰å¤šä¸ªå­åŸŸåï¼ˆå¦‚chat.helloworld.comç­‰ï¼‰ï¼Œç„¶åå®¶é‡Œçš„ç½‘ç»œæ˜¯è¿™æ ·çš„

  ![image-20210223003710732](LetsEncrypt.assets/image-20210223003710732.png)

  openwrtä¸Šæœ‰DDNSï¼Œæˆ‘ä»¬æŠŠå­åŸŸåå…¨éƒ¨æŒ‡å‘è·¯ç”±å™¨ï¼Œç„¶åå†å†è·¯ç”±å™¨ä¸Šé…ç½®è½¬å‘è§„åˆ™å°†è®¿é—®åŸŸåçš„æ•°æ®æŒ‡å‘å†…ç½‘dockeræœåŠ¡å™¨ï¼Œç„¶åå†dockerå†…ç½‘ä¸­ç”±letsencryptå…¨æƒæ¥ç®¡å¹¶ä¸”æ ¹æ®å­åŸŸåè½¬å‘ç»™ç›¸åº”çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚chat.helloworld.com çš„æ•°æ®å…¨éƒ¨ç”±RocketchatæœåŠ¡æ¥æ”¶ï¼Œcloud.helloworld.comçš„æ•°æ®å…¨éƒ¨ç”±NextcloudæœåŠ¡æ¥æ”¶ï¼Œè€Œä¸”letsencryptæœåŠ¡è¿˜å¯ä»¥å¸®æˆ‘ä»¬å¯ç”¨httpsåŠ å¯†ï¼Œå¹¶ä¸”è‡ªåŠ¨ç»­æœŸè¯ä¹¦ï¼ˆä¸€èˆ¬æ¥è¯´è¿™ç§ä¸´æ—¶çš„è¯ä¹¦æœ‰æ•ˆæœŸéƒ½å¾ˆçŸ­ï¼Œä¸€èˆ¬æ˜¯3ä¸ªæœˆï¼‰ï¼Œè¿™æ ·å°±å¾ˆå®‰é€¸äº†ã€‚

  > * Tips
  >
  >   è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåŸŸåæä¾›å•†çš„å‘ï¼Œæœ‰äº›æœåŠ¡å•†åªèƒ½æä¾›DDNSæœåŠ¡ï¼Œä¸èƒ½æä¾›letsencryptçš„éªŒè¯ ï¼ˆç¬”è€…ä½¿ç”¨çš„oryèŠ±ç”Ÿå£³å°±æ˜¯ä¸å¯ä»¥çš„ï¼Œå¦‚æœæ˜¯å®¶ç”¨DDNSè·å–å…¬ç½‘ipçš„è¯ï¼Œä¸å¼€é€š80ç«¯å£æ˜¯æ— æ³•å®ŒæˆéªŒè¯çš„ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ¢åˆ°å…¶ä»–æä¾›å•†ä¾‹å¦‚é˜¿é‡Œäº‘å»è§£æäº†ã€‚

## Letâ€˜s Encrypt Installation

è™½ç„¶ä¸æ˜¯åŒä¸€æ—¶é—´ï¼Œä½†æ˜¯å´æ˜¯åŒä¸€ä¸ª ~~æ’¤ç¡•~~ dockerï¼Œæˆ‘è¿˜æ˜¯é‚£å¥è¯ï¼Œå¥¥é‡Œç»™ï¼ä¸Šä»£ç ï¼

```shell
docker run 
  -itd     					#
  --cap-add=NET_ADMIN       #
  --name=letsencrypt        #
  --net='OscarsNet'         #ç½‘ç»œåç§°
  -v /home/docker/letsencrypt/appconfig/:/config:rw
  							#æ˜ å°„é…ç½®æ–‡ä»¶å¤¹
  -e PGID=1000 
  -e PUID=1000 
  -e EMAIL=oscar@qq.com     #é¢å‘caæ˜¯éœ€è¦çš„email
  -e URL=baidu.cmo          #ä½ çš„é¡¶çº§åŸŸå
  -e SUBDOMAINS=chat,qq,baidu  #å­åŸŸå
  -e ONLY_SUBDOMAINS=true   #åªä¸ºå­åŸŸåç”³è¯·sslè¯ä¹¦
  -e DHLEVEL=2048           #ä¿æŒä¸å˜å³
  -e VALIDATION=dns 		#ä½¿ç”¨dnséªŒè¯ï¼ˆä¿æŒä¸å˜å³å¯ï¼‰
  -e DNSPLUGIN=aliyun 		#dnséªŒè¯æ’ä»¶ï¼ˆä¿æŒä¸å˜å³å¯ï¼‰
  -p '8088:80/tcp'         
  -p '2443:443/tcp'         #ç«¯å£æ˜ å°„
  -e TZ=Asia/Shanghai       #åœ°åŸŸé€‰æ‹©
  linuxserver/letsencrypt
```

  ```shell
docker run \
  -itd \
  --cap-add=NET_ADMIN \
  --name=letsencrypt \
  --net='bravenet' \
  -v /opt/docker/appdata/letsencrypt/:/config:rw \
  -e PGID=1000 \
  -e PUID=1000 \
  -e EMAIL=braveru@balabala.com \
  -e URL=braveru.space \
  -e SUBDOMAINS=chat,qq,baidu \
  -e ONLY_SUBDOMAINS=true \
  -e DHLEVEL=2048 \
  -e VALIDATION=dns \
  -e DNSPLUGIN=aliyun \
  -p '8088:80/tcp'  \
  -p '2443:443/tcp'  \
  -e TZ=Asia/Shanghai \
  linuxserver/letsencrypt
  ```

